<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>arozsync</title>
    <link rel="stylesheet" href="./script/tocas.min.css" />
    <script src="./script/jquery.min.js"></script>
    <style>
      .footer{
        position: absolute;
        bottom: 0px;
        left: 0px;
        padding: 0.8em;
      }

      .nopointer{
        pointer-events: none;
        user-select: none;
      }

      .tab{
        position: relative;
        height: 100vh;
      }
      .tab:not(.active){
        display:none;
      }
    </style>
  </head>

  <body>
    <!-- home page-->
    <div id="homepage" class="active tab">
      <img class="ts-image is-fluid nopointer" src="img/banner.png">
      <div class="ts-container" style="margin-top: 1em;">
        <p><span class="ts-icon is-star-icon" style="color: var(--ts-warning-500)"></span> Here are a few steps requires before you can sync your files from your ArozOS server</p>
        <div class="ts-list is-ordered">
            <div class="item">Connect to an ArozOS server</div>
            <div class="item">Login with your account</div>
            <div class="item">Start synchronizing folders</div>
        </div>
        <div class="ts-divider is-section"></div>
        <button onclick="switchTab('scanner'); startScan();" class="ts-button is-start-icon is-fluid" style="color: white; background-color: var(--ts-primary-400); border: 0px solid transparent; padding: 0.6em;"><i class="ts-icon is-circle-nodes-icon"></i> Start Scanning</button>
        <small>or <a href="#"  onclick="switchTab('manual');">setup connection manually</a></small>
      </div>
      <div class="footer">
        <small>CopyRight ArozOS Project 2021 - <span class="year"></span></small>
      </div>
    </div>

    <!-- scanner -->
    <div id="scanner" class="tab">
      <br>
      <div class="ts-container">
          <p>Scanning nearby ArozOS nodes</p>
          <div class="ts-divider"></div>
            <div class="ts-box">
              <table class="ts-table is-basic">
                  <thead>
                      <tr>
                          <th>Hostname</th>
                          <th>IP address</th>
                          <th>Connect</th>
                      </tr>
                  </thead>
                  <tbody id="scannedList">
                      <tr>
                        <td colspan="3">
                          <div class="ts-center">
                            <div class="ts-loading is-notched"></div>
                          </div>
                        </td>
                      </tr>
                  </tbody>
              </table>
          </div>
          <small>Can't see your node? <a href="#" onclick="switchTab('manual');">Add your server manually</a></small>
      </div>
      <div class="footer">
        <button class="ts-button is-outlined" onclick="switchTab('homepage');">Cancel</button>
    </div>

    <!-- Manual IP adding-->

    <!-- IP Addr Validation -->
    
    </div>
    <script src="main.js"></script>
    <script>
      var bufferedHostsList = [];

      $(".year").text(new Date().getFullYear());

      function switchTab(tabName="homepage"){
        $(".active.tab").removeClass("active");
        $("#" + tabName).addClass('active');
      }

      /*
        IP Discover Related
      */

      /*
         Scanner Related
      */

      function startScan(){
        $("#scannedList").html(`
          <tr>
            <td colspan="3">
              <div class="ts-center">
                <div class="ts-loading is-notched"></div>
              </div>
            </td>
          </tr>`);
        ScanNearbyArozOS(function(results){
            if (results != ""){
                //ok
                results = JSON.parse(results);
                $("#scannedList").html("");
                bufferedHostsList = results;
                results.forEach(device => {
                  var thisHostname = device.HostName.replace(".local.", "") + "<br>(" + device.MinorVersion + ")";
                  var ipv4Links = [];
                  device.IPv4.forEach(thisIp => {
                    ipv4Links.push(`<a href="#" onclick="OpenLinkInBrowser('http://${thisIp}:${device.Port}/');">${thisIp}</a>`);
                  });
                  
                  $("#scannedList").append(`<tr>
                      <td><a onclick="connectToHost('${device.UUID}');">${thisHostname}</a></td>
                      <td>${ipv4Links.join("<br>")}</td>
                      <td align="center"><button class="ts-button is-small is-dense is-icon">
                          <span class="ts-icon is-link-icon"></span>
                      </button></td>
                  </tr>`);
                  });

                if (results.length == 0){
                  $("#scannedList").html(`
                    <tr>
                      <td colspan="3">
                        <div class="ts-center">
                          <div class="ts-icon -is-remove-icon"></div> No Nearby ArozOS Device<br><a onclick="startScan();">Rescan</a>
                        </div>
                      </td>
                    </tr>`);
                }
            }else{
                //error
            }
        });
      }
    </script>
  </body>
</html>
